{"version":3,"sources":["../../src/dialog/processors.js"],"names":["module","exports","default","id","send","message","originalEvent","state","flowContext","rendered","value","additionalData","includes","Mustache","render","event","_","pick","_context","currentFlow","length","JSON","parse","text","reply","type"],"mappings":";;;;AAAA;;;;AACA;;;;;;AAEAA,OAAOC,OAAP,GAAiB;AACfC,WAAS;AACPC,QAAI,cADG;AAEPC,UAAM,CAAC,EAAEC,OAAF,EAAWC,aAAX,EAA0BC,KAA1B,EAAiCC,WAAjC,EAAD,KAAoD;AACxD,UAAIC,WAAWJ,QAAQK,KAAvB;;AAEA,UAAIC,iBAAiB,EAAEJ,KAAF,EAArB;;AAEA,UAAIE,YAAYA,SAASG,QAAT,CAAkB,IAAlB,CAAhB,EAAyC;AACvCH,mBAAWI,mBAASC,MAAT,CAAgBL,QAAhB,eACNF,KADM;AAETQ,iBAAOC,iBAAEC,IAAF,CAAOX,aAAP,EAAsB,CAAC,KAAD,EAAQ,MAAR,EAAgB,MAAhB,EAAwB,UAAxB,EAAoC,MAApC,CAAtB,CAFE;AAGTY,iCACKF,iBAAEC,IAAF,CAAOT,WAAP,EAAoB,CAAC,MAAD,EAAS,WAAT,CAApB,CADL;AAEEW,yBAAaH,iBAAEC,IAAF,CAAOT,YAAYW,WAAnB,EAAgC,CAAC,MAAD,EAAS,SAAT,EAAoB,WAApB,CAAhC;AAFf;AAHS,WAAX;AAQD;;AAED;AACA;AACA,UAAIV,YAAYA,SAAS,CAAT,MAAgB,GAA5B,IAAmCA,SAASA,SAASW,MAAT,GAAkB,CAA3B,MAAkC,GAAzE,EAA8E;AAC5ET,sCAAsBA,cAAtB,EAAyCU,KAAKC,KAAL,CAAWb,QAAX,CAAzC;AACD,OAFD,MAEO,IAAIA,QAAJ,EAAc;AACnBE,sCAAsBA,cAAtB,IAAsCY,MAAMd,QAA5C;AACD;;AAED,aAAOH,cAAckB,KAAd,CAAoBnB,QAAQoB,IAA5B,EAAkCd,cAAlC,CAAP;AACD;AA3BM;AADM,CAAjB","file":"processors.js","sourcesContent":["import Mustache from 'mustache'\nimport _ from 'lodash'\n\nmodule.exports = {\n  default: {\n    id: 'send-message',\n    send: ({ message, originalEvent, state, flowContext }) => {\n      let rendered = message.value\n\n      let additionalData = { state }\n\n      if (rendered && rendered.includes('{{')) {\n        rendered = Mustache.render(rendered, {\n          ...state,\n          event: _.pick(originalEvent, ['raw', 'text', 'type', 'platform', 'user']),\n          _context: {\n            ..._.pick(flowContext, ['node', 'flowStack']),\n            currentFlow: _.pick(flowContext.currentFlow, ['name', 'version', 'startNode'])\n          }\n        })\n      }\n\n      // Check if it's JSON\n      // This form is supposed to be more performant compared to regex\n      if (rendered && rendered[0] === '{' && rendered[rendered.length - 1] === '}') {\n        additionalData = { ...additionalData, ...JSON.parse(rendered) }\n      } else if (rendered) {\n        additionalData = { ...additionalData, text: rendered }\n      }\n\n      return originalEvent.reply(message.type, additionalData)\n    }\n  }\n}\n"]}